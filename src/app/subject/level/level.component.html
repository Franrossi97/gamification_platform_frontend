<div style="align-items: center;">
  <br>
  <div class="row" *ngFor="let level of levels; let i=index" style="margin-top: 2rem">
    <div [class.col-md-8]='userType==1' [class.col-md-12]='userType!=1'>
      <div class="card text-center">
        <div class="card-header" *ngIf="showEditName!=level.id_nivel">
          {{level.descripcion}}
          <button class="btn btn-info" (click)='onEditName(level.id_nivel)' *ngIf="userType==1" style="font-size: 0.8rem;"><fa-icon [icon]='editIcon'></fa-icon></button>
        </div>
        <div class="card-header" *ngIf="showEditName==level.id_nivel">

          <form [formGroup]='editNameForm' (ngSubmit)="onSubmitNewName(level.id_nivel)">
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <input class="form-control" type="text" placeholder="Nuevo nombre del nivel" formControlName='name' maxlength="200" minlength="1">
                  <span *ngIf="editNameForm.get('name').touched && editNameForm.get('name').invalid" class="error-input">Ingrese un nombre válido</span>
                </div>
              </div>

              <div class="col-md-3">
                <button class="btn btn-success" type="submit" [disabled]='editNameForm.invalid'>Cambiar nombre</button>
              </div>

              <div class="col-md-3">
                <button class="btn btn-danger" type="button" (click)='cancelEditName()'>Cancelar</button>
              </div>
            </div>
          </form>
        </div>

        <div class="card-body">
          <h3 class="card-title">Nivel {{i+1}}</h3>

          <ul class="list-cover" *ngFor="let unit of level.unitList">
            <li class="unit-level" *ngIf="showEditUnit!=unit.id_unidad">
              {{unit.nombre}}
              <button class="btn btn-info" (click)='onEditNameUnit(unit.id_unidad)' *ngIf="userType==1" style="font-size: 0.7rem;"><fa-icon [icon]='editIcon'></fa-icon></button>&nbsp;
              <button class="btn btn-danger" (click)='onDeleteUnit(unit.id_unidad)' *ngIf="userType==1" style="font-size: 0.7rem;"><fa-icon [icon]='trashIcon'></fa-icon></button>
            </li>

            <li class="unit-level" *ngIf="showEditUnit==unit.id_unidad">
              <form [formGroup]='editUnitNameForm' (ngSubmit)="onSubmitNewUnitName(unit.id_unidad)">
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group">
                      <input class="form-control" type="text" placeholder="Nuevo nombre de al unidad" formControlName='name' maxlength="200" minlength="1">
                      <span *ngIf="editUnitNameForm.get('name').touched && editUnitNameForm.get('name').invalid" class="error-input">Ingrese un nombre válido</span>
                    </div>
                  </div>

                  <div class="col-md-3">
                    <button class="btn btn-success" type="submit" [disabled]='editUnitNameForm.invalid'>Cambiar nombre</button>
                  </div>

                  <div class="col-md-3">
                    <button class="btn btn-danger" type="button" (click)='cancelEditUnitName()'>Cancelar</button>
                  </div>
                </div>
              </form>
            </li>
          </ul>


          <form [formGroup]='newUnitForm' (ngSubmit)="onSubmitNewUnit(level.id_nivel)" *ngIf="showNewUnit==level.id_nivel">
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <input class="form-control" type="text" placeholder="Nueva unidad" formControlName='name' maxlength="200" minlength="1">
                  <span *ngIf="newUnitForm.get('name').touched && newUnitForm.get('name').invalid" class="error-input">Ingrese un nombre válido</span>
                </div>
              </div>

              <div class="col-md-3">
                <button class="btn btn-success" type="submit" [disabled]='newUnitForm.invalid'>Crear</button>
              </div>

              <div class="col-md-3">
                <button class="btn btn-danger" type="button" (click)='cancelNewUnit()'>Cancelar</button>
              </div>
            </div>
          </form>
          <button class="btn btn-info" (click)='onAddNewUnit(level.id_nivel)' *ngIf="userType==1 && showNewUnit!=level.id_nivel" style="font-size: 0.8rem;">
            <fa-icon [icon]='plusIcon'></fa-icon> Agregar nueva unidad
          </button><br><br>

          <!--<p class="card-text">With supporting text below as a natural lead-in to additional content.</p>-->
          <a class="btn btn-primary" (click)="onEdit(level.id_nivel)" routerLink='level/{{level.id_nivel}}' *ngIf="userType==1">Editar</a>
          <button class="btn btn-primary" *ngIf="userType==2" [disabled]='!level.cuestionario_disponible' (click)="onPlay(level.id_nivel, level.penalizacion, level.puntaje_maximo, level.cantidad_preguntas)">
            Jugar
          </button><br><br>
          <div *ngIf="userType==1">
            <button class="btn btn-success" *ngIf="!level.cuestionario_disponible" (click)='onChangeAvailability(i, level.id_nivel, level.cuestionario_disponible)'>Habilitar cuestionario</button>
            <button class="btn btn-secondary" *ngIf="level.cuestionario_disponible" (click)='onChangeAvailability(i, level.id_nivel, level.cuestionario_disponible)'>Deshabilitar cuestionario</button>
          </div>

          <br>
          <div *ngIf="userType==1 && showNewScore!=level.id_nivel">
            Puntaje máximo: {{level.puntaje_maximo}}

            <button class="btn btn-info" (click)='onEditScore(level.id_nivel)' style="font-size: 0.8rem;"><fa-icon [icon]='editIcon'></fa-icon></button>
          </div>

          <form [formGroup]='newMaxScoreForm' (ngSubmit)="onSubmitNewUnit(level.id_nivel)" *ngIf="showNewScore==level.id_nivel">
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <input class="form-control" type="number" placeholder="800" formControlName='score' min="0">
                  <span *ngIf="newMaxScoreForm.get('score').touched && newMaxScoreForm.get('score').invalid" class="error-input">Ingrese un puntaje válido</span>
                </div>
              </div>

              <div class="col-md-3">
                <button class="btn btn-success" type="submit" [disabled]='newMaxScoreForm.invalid'>Cambiar</button>
              </div>

              <div class="col-md-3">
                <button class="btn btn-danger" type="button" (click)='cancelNewScore()'>Cancelar</button>
              </div>
            </div>
          </form>

        </div>
        <div class="card-footer text-muted">
          <div class="row">
            <div class="col-md" style="border-right: 1px solid lightgrey;">
              Created: {{calculateDateDifference(level.fecha_creacion)}} days ago
            </div>
            <div class="col-md" style="border-right: 1px solid lightgrey;">
              Played: {{level.cantidad_estudiantes_intentos}} out of {{cantStudents}} students
            </div>
            <div class="col-md">
              Average score: 286/1000
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-4" *ngIf="editingLevelId==level.id_nivel">
      <!--<router-outlet></router-outlet>-->
      <app-edit-subject [editingLevelId]='editingLevelId'></app-edit-subject>
    </div>
  </div>
</div>
